<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Ventas - Usuario</title>
    <link rel="stylesheet" href="CSS/dashboard_user.css">
</head>
<body>

<div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="brand">
            <h2>UTP</h2>
            <p>Gesti√≥n de Ventas</p>
        </div>

        <div class="user-info">
            <div class="user-avatar">üë§</div>
            <p class="user-name">Empleado</p>
        </div>

        <nav class="menu">
            <a href="dashboard_user.html">üçΩ Men√∫s</a>
            <a href="promociones.html">üéÅ Promociones</a>
            <a href="usuarios.html">üë§ Mi Perfil</a>
            <a href="ventas_user.html" class="active">üíµ Gesti√≥n de Ventas</a>
        </nav>

        <a href="/logout" class="logout">Cerrar Sesi√≥n</a>
    </aside>

    <!-- ========================================= -->
    <!--   üëâ Usuario logueado (para registrar venta) -->
    <!-- ========================================= -->
    <input type="hidden" id="usuarioLogueado" value="">

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main-content">
        <h1 class="title">Registro de Ventas</h1>

        <!-- FORMULARIO DE VENTAS -->
        <section class="card">
            <form id="ventaForm" class="form">

                <label>Producto:</label>
                <select id="productoSelect" required class="input"></select>

                <label>Cantidad:</label>
                <input type="number" id="cantidad" min="1" value="1" required class="input">

                <label>Precio Unitario (S/):</label>
                <input type="number" id="precio" step="0.01" readonly class="input">

                <label>Total (S/):</label>
                <input type="number" id="total" step="0.01" readonly class="input">

                <button class="btn-primary" type="submit">Registrar Venta</button>
            </form>
        </section>

        <!-- LISTA DE VENTAS -->
        <section class="card">
            <h2 class="subtitle">Ventas Realizadas</h2>

            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Total</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody id="ventasTableBody"></tbody>
            </table>
        </section>

    </main>
</div>

<script>
    // =======================================
    //   IMPORTANTE ‚Äî EXTRAER USUARIO LOGUEADO
    // =======================================
    async function obtenerUsuarioLogueado() {
        try {
            const resp = await fetch("/api/usuario/mi-info");
            if (!resp.ok) return;

            const data = await resp.json();
            document.getElementById("usuarioLogueado").value = data.username;
        } catch (e) {
            console.error("No se pudo obtener el usuario logueado:", e);
        }
    }

    obtenerUsuarioLogueado();
</script>

<script src="js/ventas_user.js"></script>

</body>
</html>
